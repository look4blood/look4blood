<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin Login - Blood Donor Finder</title>
<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
  /* --- Full CSS from your original design --- */

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Arial', sans-serif;
    height: 100vh;
    background: linear-gradient(135deg, #000000, #1a1a1a);
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #particle-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: -1;
  }

  .login-container {
    background: rgba(0, 0, 0, 0.8);
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(255,0,0,0.4);
    width: 350px;
    max-width: 90%;
    animation: slideFade 1s ease-out;
    position: relative;
  }

  @keyframes slideFade {
    from {
      opacity: 0;
      transform: translateY(-30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .header {
    text-align: center;
    margin-bottom: 20px;
    color: #ff4d4d;
    position: relative;
  }

  .header i {
    font-size: 2.5em;
    display: block;
    margin-bottom: 10px;
    color: #ff4d4d;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(1.1); }
  }

  h2 {
    font-size: 1.2em;
    margin-bottom: 10px;
  }

  form {
    display: flex;
    flex-direction: column;
  }

  input[type="text"],
  input[type="password"] {
    padding: 12px 15px;
    margin-bottom: 15px;
    border: 2px solid #ff4d4d;
    border-radius: 8px;
    background: transparent;
    color: #fff;
    font-size: 1em;
    outline: none;
    transition: all 0.3s ease;
  }

  input[type="text"]:focus,
  input[type="password"]:focus {
    box-shadow: 0 0 10px #ff4d4d;
    border-color: #ff4d4d;
  }

  input::placeholder {
    color: #ccc;
  }

  /* Password toggle style */
  .password-wrapper {
    position: relative;
  }

  .toggle-password {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: #ff4d4d;
    font-size: 1em;
    transition: all 0.3s ease;
  }

  .toggle-password:hover {
    color: #ff1a1a;
  }

  /* Button styles */
  button {
    padding: 14px;
    margin-top: 10px;
    background: linear-gradient(135deg, #ff4d4d, #cc0000);
    border: none;
    border-radius: 8px;
    color: #fff;
    font-size: 1.1em;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    box-shadow: 0 0 15px #ff4d4d;
    transition: all 0.3s ease;
  }

  button:hover {
    box-shadow: 0 0 25px #ff4d4d, inset 0 0 10px #ff4d4d;
    transform: scale(1.02);
  }

  @keyframes neon-glow {
    from {
      box-shadow: 0 0 15px #ff4d4d;
    }
    to {
      box-shadow: 0 0 25px #ff4d4d, inset 0 0 10px #ff4d4d;
    }
  }

  button:hover {
    animation: neon-glow 1.5s infinite alternate;
  }

  /* Ripple effect */
  .ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(255,255,255,0.6);
    transform: scale(0);
    animation: ripple 0.6s linear;
    pointer-events: none;
  }

  @keyframes ripple {
    to {
      transform: scale(4);
      opacity: 0;
    }
  }

  /* Alert styles */
  .alert {
    position: absolute;
    top: -60px;
    width: 100%;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: bold;
    text-align: center;
    transition: all 0.5s ease;
    opacity: 0;
    pointer-events: none;
    z-index: 10;
  }
  .alert-success { background-color: #4BB543; color: white; }
  .alert-error { background-color: #FF4C4C; color: white; }
  .alert-warning { background-color: #FFCC00; color: black; }

  /* Locked overlay */
  .locked-overlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 2em;
    color: #ff4d4d;
    border-radius: 15px;
    animation: lockFade 1s forwards;
    z-index: 20;
    flex-direction: column;
  }

  @keyframes lockFade {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* Admin badge */
  .admin-badge {
    position: absolute;
    top: -40px;
    right: -40px;
    background: linear-gradient(135deg, #ff4d4d, #b30000);
    padding: 15px;
    border-radius: 50%;
    box-shadow: 0 0 10px #ff4d4d;
    font-size: 1.5em;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Responsive */
  @media(max-width: 400px){
    .login-container {
      width: 90%;
      padding: 30px 20px;
    }
  }
</style>
</head>
<body>

<canvas id="particle-canvas"></canvas>

<div class="login-container" id="loginContainer">
  <div class="admin-badge" title="Admin Access"><i class="fas fa-user-shield"></i></div>
  <!-- Alert message -->
  <div id="alertMessage" class="alert"></div>
  <!-- Lock overlay placeholder -->
  <div id="lockOverlay"></div>
  
  <div class="header">
    <i class="fas fa-lock"></i>
    <h2>Admin Panel â€“ Blood Donor Finder</h2>
  </div>
  <form id="loginForm" autocomplete="off">
    <input type="text" placeholder="Username" required />
    <div class="password-wrapper">
      <input type="password" placeholder="Password" id="password" required />
      <span class="toggle-password" id="togglePassword"><i class="fas fa-eye"></i></span>
    </div>
    <button type="submit" id="loginBtn">Login</button>
  </form>
</div>

<!-- Optional sound effect -->
<audio id="clickSound" src="https://actions.google.com/sounds/v1/buttons/button_press.ogg" preload="auto"></audio>

<!-- REMOVE old supabase script tag -->

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

  const supabaseUrl = 'https://bbvyjeljeyofswuijlyg.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJidnlqZWxqZXlvZnN3dWlqbHlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3OTY2MzEsImV4cCI6MjA2NzM3MjYzMX0.m3YNxZK-W8thAsuo8FAda49Bz5zbQHDaTfi-6yY136I';
  const supabase = createClient(supabaseUrl, supabaseKey);

  let loginAttempts = 0;
  const maxAttempts = 3;

  const alertDiv = document.getElementById('alertMessage');
  const lockOverlay = document.getElementById('lockOverlay');
  const loginForm = document.getElementById('loginForm');
  const loginBtn = document.getElementById('loginBtn');
  const clickSound = document.getElementById('clickSound');
  const togglePassword = document.getElementById('togglePassword');
  const passwordInput = document.getElementById('password');

  function showAlert(message, type) {
    alertDiv.innerText = message;
    alertDiv.className = 'alert'; // reset classes
    if (type === 'success') alertDiv.classList.add('alert-success');
    else if (type === 'error') alertDiv.classList.add('alert-error');
    else if (type === 'warning') alertDiv.classList.add('alert-warning');

    alertDiv.style.opacity = 1;
    setTimeout(() => {
      alertDiv.style.opacity = 0;
    }, 3000);
  }

  function lockForm() {
    // disable inputs
    Array.from(loginForm.elements).forEach(el => el.disabled = true);
    // show overlay
    lockOverlay.innerHTML = `<div><i class="fas fa-lock"></i> Locked</div>`;
    lockOverlay.style.display = 'flex';
  }

  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    // ripple effect
    const rect = loginBtn.getBoundingClientRect();
    const ripple = document.createElement('span');
    ripple.className = 'ripple';
    ripple.style.width = ripple.style.height = Math.max(rect.width, rect.height) + 'px';
    ripple.style.left = e.clientX - rect.left - (Math.max(rect.width, rect.height)/2) + 'px';
    ripple.style.top = e.clientY - rect.top - (Math.max(rect.width, rect.height)/2) + 'px';
    loginBtn.appendChild(ripple);
    ripple.addEventListener('animationend', () => ripple.remove());

    // sound effect
    clickSound.currentTime = 0;
    clickSound.play();

    const username = loginForm.querySelector('input[type="text"]').value.trim();
    const password = passwordInput.value.trim();

    try {
      const { data, error } = await supabase.auth.signInWithPassword({
        email: username,
        password: password
      });

      if (error || !data.session) {
        throw error || new Error('Invalid login');
      }

      showAlert('Login successful! Redirecting...', 'success');
      setTimeout(() => {
        window.location.href = 'admin.html';
      }, 1500);

    } catch (err) {
      loginAttempts++;
      if (loginAttempts >= maxAttempts) {
        lockForm();
        showAlert('Too many failed attempts. Access locked.', 'error');
      } else {
        showAlert(`Login failed. Attempts left: ${maxAttempts - loginAttempts}`, 'error');
      }
    }
  });

  // toggle password visibility
  togglePassword.addEventListener('click', () => {
    const type = passwordInput.type === 'password' ? 'text' : 'password';
    passwordInput.type = type;
    togglePassword.innerHTML = `<i class="fas fa-eye${type === 'password' ? '-slash' : ''}"></i>`;
  });

  // Canvas particle code remains unchanged from your original
  const canvas = document.getElementById('particle-canvas');
  const ctx = canvas.getContext('2d');

  let particlesArray;

  const initCanvas = () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  };
  window.addEventListener('resize', initCanvas);
  initCanvas();

  class Particle {
    constructor() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * canvas.height;
      this.size = Math.random() * 3 + 1;
      this.speedX = (Math.random() - 0.5) * 0.5;
      this.speedY = (Math.random() - 0.5) * 0.5;
      this.color = 'rgba(255,0,0,0.4)';
    }
    update() {
      this.x += this.speedX;
      this.y += this.speedY;
      if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
      if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
    }
    draw() {
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
      ctx.fillStyle = this.color;
      ctx.fill();
    }
  }

  const createParticles = () => {
    particlesArray = [];
    for (let i = 0; i < 100; i++) {
      particlesArray.push(new Particle());
    }
  };

  const handleParticles = () => {
    for (let i = 0; i < particlesArray.length; i++) {
      particlesArray[i].update();
      particlesArray[i].draw();

      for (let j = i + 1; j < particlesArray.length; j++) {
        const dx = particlesArray[i].x - particlesArray[j].x;
        const dy = particlesArray[i].y - particlesArray[j].y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        if (distance < 100) {
          ctx.beginPath();
          ctx.strokeStyle = 'rgba(255,0,0,0.2)';
          ctx.lineWidth = 1;
          ctx.moveTo(particlesArray[i].x, particlesArray[i].y);
          ctx.lineTo(particlesArray[j].x, particlesArray[j].y);
          ctx.stroke();
        }
      }
    }
  };

  createParticles();

  const animate = () => {
    ctx.fillStyle = 'rgba(0,0,0,0.1)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    handleParticles();
    requestAnimationFrame(animate);
  };

  animate();

</script>
</body>
</html>
