<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Donor Rankings & Filters</title>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
<!-- Font Awesome for icons (optional) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<style>
  * {
    box-sizing: border-box;
  }

  body {
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(135deg, #f0f0f0, #d0d0d0);
    margin: 0;
    padding: 20px;
    color: #333;
  }

  header {
    background-color: #d32f2f;
    color: #fff;
    padding: 20px;
    text-align: center;
    position: relative;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    border-radius: 10px;
    margin-bottom: 20px;
  }

  #total-donors {
    position: absolute;
    top: 20px;
    left: 30px;
    background: rgba(211, 47, 47, 0.8);
    color: #fff;
    padding: 8px 12px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 1.2em;
  }

  h1 {
    margin: 0;
    font-size: 2.5em;
    letter-spacing: 2px;
  }

  #filters {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin-bottom: 30px;
  }

  button {
    background-color: #d32f2f;
    color: #fff;
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  button:hover {
    background-color: #b71c1c;
    transform: translateY(-2px);
  }

  select {
    padding: 10px 12px;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    background-color: #fff;
  }

  #donors-section {
    background-color: #fff;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  #donors-header {
    text-align: center;
    font-size: 2em;
    color: #d32f2f;
    margin-bottom: 10px;
    font-weight: 700;
  }

  #donors-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
  }

  .donor-card {
    display: flex;
    align-items: center;
    background: #fff;
    border-radius: 15px;
    padding: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    transition: transform 0.3s, box-shadow 0.3s;
  }

  .donor-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(0,0,0,0.2);
  }

  .rank {
    font-size: 1.8em;
    font-weight: bold;
    width: 50px;
    text-align: center;
    margin-right: 15px;
  }

  /* Top 3 highlight background */
  .donor-card:nth-child(-n+3) {
    background: #ffe5b4;
  }

  .info {
    flex: 1;
  }

  .name {
    font-size: 1.4em;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .details {
    margin-top: 8px;
  }

  .detail {
    margin: 4px 0;
    font-size: 0.95em;
  }

  /* Badge styles with symbols instead of images */
  .badge {
    display: inline-flex;
    align-items: center;
    padding: 8px 12px;
    border-radius: 20px;
    font-size: 1.1em;
    font-weight: 600;
    margin-top: 10px;
    cursor: default;
    transition: all 0.4s ease;
  }

  /* Badge colors */
  .badge-bronze { background-color: #cd7f32; color: #fff; }
  .badge-silver { background-color: #C0C0C0; color: #000; }
  .badge-golden { background-color: #ffd700; color: #000; }
  .badge-platinum { background-color: #e5e4e2; color: #000; }
  .badge-diamond { background-color: #800080; color: #fff; }

  /* Symbols for badges */
  .badge-symbol {
    font-size: 1.2em;
    margin-right: 8px;
  }

  /* Badge hover effect (optional) */
  .badge:hover {
    transform: scale(1.05);
  }

  /* Rank symbols container */
  #rank-badges {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
  }

  .rank-badge {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    border-radius: 15px;
    background: #fff;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transition: transform 0.3s, box-shadow 0.3s;
  }

  .rank-badge:hover {
    transform: scale(1.1);
    box-shadow: 0 12px 24px rgba(0,0,0,0.2);
  }

  .rank-icon {
    font-size: 2em;
    margin-bottom: 8px;
  }

  /* Responsive adjustments */
  @media(max-width: 768px){
    #donors-container {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>

<header>
  <h1>Donor Rankings & Filters</h1>
  <div id="total-donors">Total Donors: 0</div>
</header>

<!-- Filters -->
<div id="filters" style="flex-wrap:wrap; justify-content:center;">
  <button data-filter="all" class="active">All</button>
  <button data-filter="top3">Top 3</button>
  <button data-filter="bronze">Bronze</button>
  <button data-filter="silver">Silver</button>
  <button data-filter="gold">Gold</button>
  <button data-filter="platinum">Platinum</button>
  <button data-filter="diamond">Diamond</button>
  <select id="bloodGroupFilter" aria-label="Select Blood Group">
    <option value="all">All Blood Groups</option>
  </select>
  <select id="cityFilter" aria-label="Select City">
    <option value="all">All Cities</option>
  </select>
  <select id="badgeFilter" aria-label="Select Badge">
    <option value="all">All Badges</option>
    <option value="bronze">Bronze</option>
    <option value="silver">Silver</option>
    <option value="gold">Gold</option>
    <option value="platinum">Platinum</option>
    <option value="diamond">Diamond</option>
  </select>
</div>

<!-- Donors list -->
<div id="donors-section">
  <div id="donors-header">Donor List</div>
  <div id="donors-container"></div>
</div>

<!-- Badge Ranks & Symbols -->
<h3 style="text-align:center; margin-top:40px; color:#d32f2f;">Badge Ranks & Symbols</h3>
<div id="rank-badges">
  <div class="rank-badge" data-rank="bronze">
    <div class="rank-icon">ðŸ¥‰</div>
    <div>Bronze (1-3)</div>
  </div>
  <div class="rank-badge" data-rank="silver">
    <div class="rank-icon">ðŸ¥ˆ</div>
    <div>Silver (4-15)</div>
  </div>
  <div class="rank-badge" data-rank="gold">
    <div class="rank-icon">ðŸ¥‡</div>
    <div>Gold (16-20)</div>
  </div>
  <div class="rank-badge" data-rank="platinum">
    <div class="rank-icon">ðŸ’ </div>
    <div>Platinum (21-30)</div>
  </div>
  <div class="rank-badge" data-rank="diamond">
    <div class="rank-icon">ðŸ’Ž</div>
    <div>Diamond (31+)</div>
  </div>
</div>

<!-- Include Supabase JS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/supabase.min.js"></script>
<script>
  // Replace with your actual Supabase anon key
  const supabaseUrl = 'https://bbvyjeljeyofswuijlyg.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJidnlqZWxqZXlvZnN3dWlqbHlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3OTY2MzEsImV4cCI6MjA2NzM3MjYzMX0.m3YNxZK-W8thAsuo8FAda49Bz5zbQHDaTfi-6yY136I'; // <-- Replace this
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  const tableName = 'donors';

  let donors = [];

  // Fetch donors from Supabase
async function fetchDonors() {
  try {
    const { data, error } = await supabase
      .from(tableName)
      .select('*');

    if (error) {
      console.error('Error fetching donors:', error);
      alert('Error fetching donors: ' + error.message);
      return;
    }

    donors = data || [];
    processDonors();

  } catch (err) {
    console.error('Error:', err);
  }
}

// Process and display donors
function processDonors() {
  donors.sort((a, b) => (b.times_donated || 0) - (a.times_donated || 0));
  donors.forEach((d, i) => d.rank = i + 1);
  populateFilters();
  renderDonors(donors);
  updateTotalDonors();
}

// Populate filter dropdowns
function populateFilters() {
  const bloodSet = new Set();
  const citySet = new Set();
  donors.forEach(d => {
    if (d.blood_group) bloodSet.add(d.blood_group);
    if (d.city) citySet.add(d.city);
  });
  const bloodSelect = document.getElementById('bloodGroupFilter');
  const citySelect = document.getElementById('cityFilter');

  bloodSelect.innerHTML = '<option value="all">All Blood Groups</option>';
  citySelect.innerHTML = '<option value="all">All Cities</option>';

  Array.from(bloodSet).sort().forEach(bg => {
    const option = document.createElement('option');
    option.value = bg;
    option.textContent = bg;
    bloodSelect.appendChild(option);
  });
  Array.from(citySet).sort().forEach(c => {
    const option = document.createElement('option');
    option.value = c;
    option.textContent = c;
    citySelect.appendChild(option);
  });
}

// Create HTML for each donor
function createDonorHTML(d, index) {
  const badge = getBadge(d.times_donated);
  return `
    <div class="donor-card" data-rank="${d.rank}" data-badge="${badge.label.toLowerCase()}" data-blood="${d.blood_group}" data-city="${d.city}">
      <div class="rank">${d.rank}</div>
      <div class="info">
        <div class="name">${d.name}</div>
        <div class="details">
          <div class="detail"><strong>Blood:</strong> ${d.blood_group}</div>
          <div class="detail"><strong>City:</strong> ${d.city}</div>
          <div class="detail"><strong>Donations:</strong> ${d.times_donated}</div>
          <div class="detail"><strong>Phone:</strong> ${d.phone}</div>
        </div>
        <div class="badge ${badge.class}">
          <span class="badge-symbol">${badge.symbol}</span>
          <span class="badge-label">${badge.label}</span>
        </div>
      </div>
    </div>
  `;
}

// Determine badge based on donations
function getBadge(donations) {
  donations = donations || 0;
  if (donations <= 3) {
    return { label: "Bronze", class: "badge-bronze", symbol: "ðŸ¥‰" };
  } else if (donations >= 4 && donations <= 15) {
    return { label: "Silver", class: "badge-silver", symbol: "ðŸ¥ˆ" };
  } else if (donations >= 16 && donations <= 20) {
    return { label: "Gold", class: "badge-golden", symbol: "ðŸ¥‡" };
  } else if (donations >= 21 && donations <= 30) {
    return { label: "Platinum", class: "badge-platinum", symbol: "ðŸ’ " };
  } else {
    return { label: "Diamond", class: "badge-diamond", symbol: "ðŸ’Ž" };
  }
}

// Render donors list
function renderDonors(data) {
  const container = document.getElementById('donors-container');
  const totalCountEl = document.getElementById('total-donors');
  if (!data || data.length === 0) {
    container.innerHTML = '<p style="text-align:center;">No donors found.</p>';
    totalCountEl.textContent = 'Total Donors: 0';
    return;
  }
  container.innerHTML = data.map(createDonorHTML).join('');
  totalCountEl.textContent = `Total Donors: ${data.length}`;
}

// Update total donors count
function updateTotalDonors() {
  document.getElementById('total-donors').textContent = `Total Donors: ${donors.length}`;
}

// Apply filters based on button and dropdown selections
function applyFilters() {
  let filtered = [...donors];

  // Filter by button
  const activeButton = document.querySelector('#filters button.active') || null;
  const filterType = activeButton ? activeButton.dataset.filter : '';

  if (filterType === 'all' || !filterType) {
    filtered = [...donors];
  } else if (filterType === 'top3') {
    filtered = donors.slice(0, 3);
  } else if (["bronze","silver","gold","platinum","diamond"].includes(filterType)) {
    filtered = donors.filter(d => {
      const badge = getBadge(d.times_donated);
      return badge.label.toLowerCase() === filterType;
    });
  }

  // Filter by dropdowns
  const bloodVal = document.getElementById('bloodGroupFilter').value;
  const cityVal = document.getElementById('cityFilter').value;
  const badgeVal = document.getElementById('badgeFilter').value;

  if (bloodVal !== 'all') {
    filtered = filtered.filter(d => d.blood_group === bloodVal);
  }
  if (cityVal !== 'all') {
    filtered = filtered.filter(d => d.city === cityVal);
  }
  if (badgeVal !== 'all') {
    filtered = filtered.filter(d => {
      const badge = getBadge(d.times_donated);
      return badge.label.toLowerCase() === badgeVal;
    });
  }

  // Re-sort
  filtered.sort((a, b) => (b.times_donated || 0) - (a.times_donated || 0));
  filtered.forEach((d, i) => d.rank = i + 1);
  renderDonors(filtered);
}

// Event listeners for filter buttons
document.querySelectorAll('#filters button').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('#filters button').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    applyFilters();
  });
});

// Event listeners for dropdowns
document.getElementById('bloodGroupFilter').addEventListener('change', applyFilters);
document.getElementById('cityFilter').addEventListener('change', applyFilters);
document.getElementById('badgeFilter').addEventListener('change', applyFilters);

// Fetch data on page load
fetchDonors();
</script>
</body>
</html>
